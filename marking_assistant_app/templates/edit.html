{% extends "base.html" %}
{% load static %}

{% block title %}Edit Assignment{% endblock %}

{% block content %}
<h1>Edit Assignment</h1>

<form method="POST">
    {% csrf_token %}

    <!-- Assignment details form -->
    {{ assignment_form.as_p }}

    <!-- Display existing tasks -->
    <div id="task-container">
        {% for task_form in task_formset %}
            <div class="task">
                <h3>Task Details</h3>
                <input type="hidden" name="task_id[]" value="{{ task_form.instance.id }}">
                <!-- Manually render task fields -->
                <label for="task_number">Task Number:</label>
                <input type="number" name="task_number[]" value="{{ task_form.task_number.value }}" required>
                <label for="task_total_marks">Total Mark for Task:</label>
                <input type="number" name="task_total_marks[]" value="{{ task_form.total_marks.value }}" required>

                <!-- Display existing criteria for this task -->
                <div class="criteria-container">
                    <h4>Criteria Details</h4>
                    {% for criteria_form in criteria_formset.forms %}
                        {% if criteria_form.instance.task == task_form.instance %}
                            <div class="criteria">
                                <input type="hidden" name="criteria_id[]" value="{{ criteria_form.instance.id }}">
                                <input type="hidden" name="task_for_criteria[]" value="{{ task_form.instance.task_number }}">
                                <!-- Manually render criteria fields -->
                                <label for="description">Description:</label>
                                <textarea name="description[]" rows="4" cols="50" required>{{ criteria_form.description.value }}</textarea>
                                <label for="marks">Marks:</label>
                                <input type="number" name="marks[]" value="{{ criteria_form.marks.value }}" required>
                                <label for="feedback_comment">Feedback Comment:</label>
                                <textarea name="feedback_comment[]" rows="4" cols="50">{{ criteria_form.feedback_comment.value }}</textarea>
                                <button type="button" class="delete-criteria">Delete Criteria</button>
                            </div>
                        {% endif %}
                    {% endfor %}
                </div>

                <button type="button" class="add-criteria">Add Criteria</button>
                <button type="button" class="delete-task">Delete Task</button>
            </div>
        {% endfor %}
    </div>

    <button type="button" class="add-task">Add Task</button>
    <button type="button" class="delete-assignment">Delete Assignment</button>

    <input type="submit" value="Save Changes">
</form>

<script src="{% static 'js/add_manage_form.js' %}"></script>
{% endblock %}
